id: aiAgentExecute1
type: datasource
subtype: JavascriptQuery
resourceName: RetoolAIAgentExecuteQuery
template:
  queryRefreshTime: ''
  allowedGroupIds: []
  streamResponse: false
  lastReceivedFromResourceAt: null
  isFunction: false
  functionParameters: null
  queryDisabledMessage: ''
  servedFromCache: false
  offlineUserQueryInputs: ''
  functionDescription: null
  successMessage: ''
  queryDisabled: ''
  instructions: >-
    You are a competitive analysis agent. Your job is to select a competitor,
    research them based on the provided URLs, write a competitive analysis, and
    compare it to previously stored analysis (if present). If the new analysis
    is materially different, update the database with the new analysis and
    notify the user.


    # Instructions

    1. Select a Competitor

    - Get a list of competitors from the database, this includes a list of URLs
    to their main website, pricing page, blog, and release notes. 

    - Ensure that only one competitor is actively selected for this analysis
    cycle.


    2. Research the Competitor

    - Use the Get Webpage Content tool to research the provided URLs for the
    competitor 

    - Synthesize the key content from these URLs before passing to the “Write
    Competitive Report” Tool. Ensure that you include all relevant details to
    write a competitive report with these categories: Competitor Overview,
    Product Features & Differentiation, Pricing Strategy, Market Positioning &
    Branding, Customer Reviews & Sentiment, Technology Stack & Integrations,
    Competitive Advantages & Weaknesses, Recent News & Developments, SWOT
    Analysis.


    3. Write the Competitive Analysis

    - Pass the synthesized key content from your research to the “Write
    Competitive Report” tool. 

    - This will output a competitive analysis report


    4. Compare Against Previous Analysis

    - Fetch the previously saved competitive analysis if you haven’t already.
    This is the report from the last time you generated a competitive analysis.

    - Use the **“Compare Reports”** tool to compare the newly written analysis
    to the previously saved version.

    - Ensure that you pass the full context of the previously saved report and
    the newly generated report correctly.  

    - Your goal at this step is to determine if the newly written analysis is
    **materially different** from the previously generated one.  
      - “Materially different” means it has significant updates or insights that would impact decision-making.
    - If there is no currently saved report, then you can save the new one to
    the database — this qualifies as materially different.


    5. Update & Notify If Needed

    - If the new analysis is materially different follow these additional steps:

    - update the database with the new analysis using the “update currently
    stored competitive report” tool.  

    - Use the **“Send Email”** tool to alert the user that a new competitive
    analysis has been saved.   

    - Provide a concise summary of the key changes or differences in your email
    to the user 


    # Key Reminders

    - Focus on accuracy and relevance when researching and writing.  

    - Use concise language in notifications to the user.  

    - Ensure that you are correctly referencing the new report and the
    previously generated report. 


    # User details 

    You are chatting with {{ current_user.fullName }}. Their email address is {{
    current_user.email }}.

    The current date is {{ new Date() }} and the user's timezone is {{ timezone
    }}.


    If the user expresses uncertainty or asks about what you can do, give them
    an overview of your capabilities and suggest the following prompt:

    1. Select a competitor and write a competitive analysis.

    2. Summarize a recent competitive analysis from our top competitor. 

    3. Is there any new material on Salesforce that we should include in our
    competitive analysis? 
  playgroundQuerySaveId: latest
  workflowParams: null
  resourceNameOverride: ''
  runWhenModelUpdates: false
  workflowRunExecutionType: sync
  showFailureToaster: true
  query: ''
  playgroundQueryUuid: ''
  playgroundQueryId: null
  error: null
  workflowRunBodyType: raw
  privateParams: []
  model: gpt-4.1
  queryRunOnSelectorUpdate: false
  runWhenPageLoadsDelay: ''
  data: null
  providerId: retoolAIBuiltIn::openAI
  importedQueryInputs: {}
  _additionalScope: []
  isImported: false
  showSuccessToaster: true
  cacheKeyTtl: ''
  requestSentTimestamp: null
  metadata: null
  queryRunTime: null
  changesetObject: ''
  offlineOptimisticResponse: null
  errorTransformer: return data.error
  finished: null
  confirmationMessage: null
  isFetching: false
  changeset: ''
  drafts:
    array: []
  rawData: null
  queryTriggerDelay: '0'
  resourceTypeOverride: null
  watchedParams: []
  temperature: 0.25
  enableErrorTransformer: false
  showLatestVersionUpdatedWarning: false
  timestamp: 0
  mcpServers:
    array: []
  importedQueryDefaults: {}
  enableTransformer: false
  showUpdateSetValueDynamicallyToggle: true
  overrideOrgCacheForUserCache: false
  runWhenPageLoads: false
  transformer: return data
  events: []
  queryTimeout: '10000'
  workflowId: null
  maxIterations: 30
  requireConfirmation: false
  queryFailureConditions: ''
  tools:
    - draft: null
      approvalRequired: false
      params:
        - name: url
          description: The full URL of the webpage to extract content from.
          type: string
          required: true
      handler:
        type: function
        functionId: 067a84c2-5632-4bd6-a105-c5f819ed3e36
      name: Get Webpage Content
      metadata:
        iconName: ToolSearch
        iconColor: gray
        predefinedToolDefinitionId: readWebpage:1
        schemaId: readWebpage
        schemaVersion: 1
        type: predefined
        summary: ''
      handlerTimeout: 10000
      id: 0f75e1e8-06dc-43e6-a05f-93e823a026d9
      description: >-
        Fetch the contents of a webpage and extract the main text content for
        analysis or processing.
    - draft: null
      approvalRequired: false
      params:
        - name: to
          description: A comma-separated list of email addresses to send the email to.
          type: string
          required: true
        - name: reply_to
          description: >-
            An email address that replies should be directed to instead of the
            sender.
          type: string
          required: false
        - name: subject
          description: A short string summarizing the purpose of the email.
          type: string
          required: true
        - name: cc
          description: >-
            A comma-separated list of email addresses to send a carbon copy
            (visible to all recipients).
          type: string
          required: false
        - name: bcc
          description: >-
            A comma-separated list of email addresses to send a blind carbon
            copy (hidden from other recipients).
          type: string
          required: false
        - name: body
          description: >-
            The main content of the email, written in Markdown. Supports
            formatting such as headings, bold text, lists, and links.
          type: string
          required: true
        - name: attachment
          description: >-
            An array of files to attach, each with the structure: 

            { data: “<base64_string>”, name: "<filename>", contentType:
            "<mime/type>" }.
          type: string
          required: false
      handler:
        type: function
        functionId: 13f820b2-64fc-4d33-a995-fb8e589dc7d2
      name: Send Email
      metadata:
        iconName: ToolEmail
        iconColor: gray
        predefinedToolDefinitionId: sendEmail:1
        schemaId: sendEmail
        schemaVersion: 1
        type: predefined
        summary: Retool Email
      handlerTimeout: 10000
      id: 5974ecc1-3115-4c95-9400-1c391e34177a
      description: Send an email using Retool Email.
    - id: a2f78cea-fa79-4aed-9219-e10edd5c526b
      name: Get Competitors
      description: >-
        Gets a list of competitors from our database, along with URLs to their
        homepage, blog, and release notes.
      approvalRequired: false
      params: []
      handler:
        type: function
        functionId: a18d832f-70d8-47fe-a9da-3e7f8297b8cc
      handlerTimeout: 10000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
    - id: 3b0a4aa0-a2e3-447c-b147-2cb9f9960aee
      name: Write competitive report
      description: >-
        Takes in a competitors ID, name, and content about from their website
        and returns a competitive report fitting our template.
      approvalRequired: false
      params:
        - id: 3eaf4fc2-6bc2-4e50-bfe0-a148b40a241f
          name: competitorWebpageContent
          description: >-
            The full webpage content of the competitor. Should include text from
            multiple webpages.
          type: string
          required: true
        - id: e9dd29f9-0355-4780-8e47-c6c93d63f4f3
          name: competitorName
          description: 'The name of the competitor. '
          type: string
          required: true
        - id: 9a656674-915b-4b48-bf88-3117ab2ecf7b
          name: competitorId
          description: 'The ID of the competitor from our database. '
          type: string
          required: true
        - id: a708d13f-7aac-43d9-9a66-f8c142a4f724
          name: competitorWebpageSummary
          description: 'A summary of the synthesized web page content from your research. '
          type: string
          required: true
      handler:
        type: function
        functionId: 54cd9400-f5e6-42a0-82e6-1625bf38786b
      handlerTimeout: 120000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
    - id: b9b300bb-b22b-4872-9f41-204b89fb654b
      name: Get Current Competitive Analysis
      description: >-
        Retrieves the currently save competitive analysis for a competitor.
        Useful for comparing against new reports.
      approvalRequired: false
      params:
        - id: 53dab68f-2080-4c0a-a55f-dd1fda6034f9
          name: competitorId
          description: The ID of the competitor.
          type: number
          required: true
          exampleValue: ''
      handler:
        type: function
        functionId: e33547cf-0b9e-460b-a8ea-f4f892b458a6
      handlerTimeout: 10000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
    - id: 0dd8e064-43eb-4486-9d42-43d6cacc9d3a
      name: Get Latest Competitive Report
      description: >-
        Gets the latest created competitive report for a competitor. Useful for
        comparing against the currently saved report.
      approvalRequired: false
      params:
        - id: e1ce6c0d-3630-4117-a7c7-f63bb857977a
          name: competitorId
          description: The ID of the competitor from our database.
          type: number
          required: true
      handler:
        type: function
        functionId: 18da9f3a-75c1-4082-ad9a-b209877533f7
      handlerTimeout: 22000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
    - id: 5770a711-31ea-4a5f-a308-ac3b68b4a14a
      name: Compare Reports
      description: >-
        Compares the newly written report with the currently stored report to
        see if there are material changes. Returns a status of either
        `materially different` or `not materially different` plus a summary of
        the reasoning. 
      approvalRequired: false
      params:
        - id: c25c0b5d-ab66-40a3-b039-e9a9f504530f
          name: currentCompetitveAnalysis
          description: The full text of the currently stored competitve analysis.
          type: string
          required: true
        - id: 416b1241-82ed-4d5c-ae01-f9e151be81ce
          name: newCompetitveAnalysis
          description: The full text of the newly generated competitve analysis.
          type: string
          required: true
      handler:
        type: function
        functionId: 3be15fae-de9d-448c-ba9c-1eff45175279
      handlerTimeout: 120000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
    - id: 0b7045c2-d657-4b95-b38f-628e542dac46
      name: 'Update currently stored competitive report. '
      description: >-
        It takes the ID of the newly generated competitive report and stores it
        on the competitors table in the database. Only use this tool once you
        have written a new competitive report and determine that it's materially
        different than the previously stored one.
      approvalRequired: false
      params:
        - id: 9100227d-fbd2-42a5-bd71-fed4e34edc4c
          name: reportId
          description: 'The ID of the newly generated competitive report. '
          type: number
          required: true
        - id: f0551f12-6332-4e81-901b-5c1e82835e3b
          name: competitorId
          description: The ID of the competitor in our Database.
          type: number
          required: true
      handler:
        type: function
        functionId: 793ca850-2415-4ae9-95d7-dfddae89b2dc
      handlerTimeout: 30000
      metadata:
        iconName: Tool
        iconColor: gray
        type: custom
  changesetIsObject: false
  providerName: openAI
  enableCaching: false
  allowedGroups: []
  offlineQueryType: None
  queryThrottleTime: '750'
  updateSetValueDynamically: false
  notificationDuration: ''
style: {}
createdAt: 2025-05-24T22:44:41.344Z
blockData:
  top: 48
  left: 480
  uuid: ab36ffe3-a7df-4f21-8188-1f3b0d87e115
  pluginId: aiAgentExecute1
  blockType: aiAgentExecute
  editorType: JavascriptQuery
  isMinimized: false
  resourceName: RetoolAIAgentExecuteQuery
  incomingPorts: []
  incomingOnSuccessEdges:
    - 66e14a20-45f4-451f-81bb-1b023d22ea5f
